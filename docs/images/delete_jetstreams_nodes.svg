<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1658.3333px" preserveAspectRatio="none" style="width:1595px;height:1658px;background:#FFFFFF;" version="1.1" viewBox="0 0 1595 1658" width="1595.8333px" zoomAndPan="magnify"><defs><filter height="300%" id="f8ourer27zhdd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0833333333333335"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.166666666666667" dy="4.166666666666667" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter><linearGradient id="g8ourer27zhdd0" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFFFF"/><stop offset="100%" stop-color="#FFFFFF"/></linearGradient><linearGradient id="g8ourer27zhdd1" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#4DABF5"/><stop offset="100%" stop-color="#2196F3"/></linearGradient><linearGradient id="g8ourer27zhdd2" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#B052C0"/><stop offset="100%" stop-color="#9C27B0"/></linearGradient></defs><g><rect fill="#FFFFFF" height="57.5846" rx="4.1667" ry="4.1667" style="stroke:#CCCCCC;stroke-width:1.0416666666666667;" width="656.25" x="477.3438" y="20.8333"/><text fill="#2196F3" font-family="&quot;Verdana&quot;" font-size="20.8333" font-weight="bold" lengthAdjust="spacing" textLength="622.9167" x="494.0104" y="56.838">Deleting jetstreams on leafnode connected devices</text><rect fill="#FFFFFF" filter="url(#f8ourer27zhdd)" height="519.4336" style="stroke:#CCCCCC;stroke-width:1.0416666666666667;" width="10.4167" x="336.9792" y="196.0612"/><rect fill="#FFFFFF" filter="url(#f8ourer27zhdd)" height="666.1133" style="stroke:#CCCCCC;stroke-width:1.0416666666666667;" width="10.4167" x="778.6458" y="900.7813"/><rect fill="url(#g8ourer27zhdd0)" filter="url(#f8ourer27zhdd)" height="512.1419" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="894.2708" x="19.7917" y="211.6862"/><rect fill="url(#g8ourer27zhdd0)" filter="url(#f8ourer27zhdd)" height="276.888" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="689.0625" x="30.2083" y="389.681"/><path d="M30.2083,569.7591 L719.2708,569.7591 L719.2708,662.4023 A4.1667,4.1667 0 0 1 715.1042,666.569 L34.375,666.569 A4.1667,4.1667 0 0 1 30.2083,662.4023 L30.2083,569.7591 " fill="url(#g8ourer27zhdd0)" style="stroke:none;stroke-width:1.0416666666666667;"/><rect fill="url(#g8ourer27zhdd0)" filter="url(#f8ourer27zhdd)" height="772.2656" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="999.4792" x="415.625" y="801.9206"/><rect fill="url(#g8ourer27zhdd0)" filter="url(#f8ourer27zhdd)" height="650.4883" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="978.6458" x="426.0417" y="916.4063"/><rect fill="url(#g8ourer27zhdd0)" filter="url(#f8ourer27zhdd)" height="349.6419" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="693.75" x="436.4583" y="961.1654"/><path d="M436.4583,1199.4466 L1130.2083,1199.4466 L1130.2083,1306.6406 A4.1667,4.1667 0 0 1 1126.0417,1310.8073 L440.625,1310.8073 A4.1667,4.1667 0 0 1 436.4583,1306.6406 L436.4583,1199.4466 " fill="url(#g8ourer27zhdd0)" style="stroke:none;stroke-width:1.0416666666666667;"/><rect fill="url(#g8ourer27zhdd0)" filter="url(#f8ourer27zhdd)" height="170.7031" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="740.625" x="653.6458" y="1388.8997"/><line style="stroke:#CCCCCC;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="151.0417" x2="151.0417" y1="144.0104" y2="1591.8945"/><line style="stroke:#CCCCCC;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="341.6667" x2="341.6667" y1="144.0104" y2="1591.8945"/><line style="stroke:#CCCCCC;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="783.8542" x2="783.8542" y1="144.0104" y2="1591.8945"/><line style="stroke:#CCCCCC;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1269.2708" x2="1269.2708" y1="144.0104" y2="1591.8945"/><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="60.4167" x="119.7917" y="89.8763"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="25" x="137.5" y="119.1874">pod</text><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="60.4167" x="119.7917" y="1590.8529"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="25" x="137.5" y="1620.164">pod</text><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="127.0833" x="277.0833" y="89.8763"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="91.6667" x="294.7917" y="119.1874">pod_controller</text><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="127.0833" x="277.0833" y="1590.8529"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="91.6667" x="294.7917" y="1620.164">pod_controller</text><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="153.125" x="705.7292" y="89.8763"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="117.7083" x="723.4375" y="119.1874">network_controller</text><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="153.125" x="705.7292" y="1590.8529"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="117.7083" x="723.4375" y="1620.164">network_controller</text><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="142.7083" x="1196.3542" y="89.8763"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="107.2917" x="1214.0625" y="119.1874">reconcile_trigger</text><rect fill="url(#g8ourer27zhdd1)" filter="url(#f8ourer27zhdd)" height="49.9674" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="142.7083" x="1196.3542" y="1590.8529"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="107.2917" x="1214.0625" y="1620.164">reconcile_trigger</text><rect fill="#FFFFFF" filter="url(#f8ourer27zhdd)" height="519.4336" style="stroke:#CCCCCC;stroke-width:1.0416666666666667;" width="10.4167" x="336.9792" y="196.0612"/><rect fill="#FFFFFF" filter="url(#f8ourer27zhdd)" height="666.1133" style="stroke:#CCCCCC;stroke-width:1.0416666666666667;" width="10.4167" x="778.6458" y="900.7813"/><polygon fill="#2196F3" points="324.4792,191.8945,334.8958,196.0612,324.4792,200.2279,328.6458,196.0612" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="151.5625" x2="330.7292" y1="196.0612" y2="196.0612"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="129.1667" x="169.2708" y="180.6132">delete pod &lt;name&gt;</text><path d="M23.9583,211.6862 L119.7917,211.6862 L119.7917,238.737 L109.375,249.1536 L19.7917,249.1536 L19.7917,215.8529 A4.1667,4.1667 0 0 1 23.9583,211.6862 " fill="#FFFFFF" style="stroke:#666666;stroke-width:1.0416666666666667;"/><rect fill="none" height="512.1419" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="894.2708" x="19.7917" y="211.6862"/><text fill="#9C27B0" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="32.2917" x="45.8333" y="234.7473">loop</text><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="197.9167" x="145.8333" y="235.789">[until the workd explodes]</text><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="347.3958" x2="391.1458" y1="310.5469" y2="310.5469"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="391.1458" x2="391.1458" y1="310.5469" y2="324.0885"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="348.4375" x2="391.1458" y1="324.0885" y2="324.0885"/><polygon fill="#2196F3" points="358.8542,319.9219,348.4375,324.0885,358.8542,328.2552,354.6875,324.0885" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="213.5417" x="365.1042" y="295.0989">check for network participant pod</text><polygon fill="#2196F3" points="771.3542,369.8893,781.7708,374.056,771.3542,378.2227,775.5208,374.056" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="347.3958" x2="777.6042" y1="374.056" y2="374.056"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="390.625" x="365.1042" y="358.608">Add podname to Info.Participating.PodsTerminating[&lt;node&gt;][]</text><path d="M34.375,389.681 L118.75,389.681 L118.75,416.7318 L108.3333,427.1484 L30.2083,427.1484 L30.2083,393.8477 A4.1667,4.1667 0 0 1 34.375,389.681 " fill="#FFFFFF" style="stroke:#666666;stroke-width:1.0416666666666667;"/><rect fill="none" height="276.888" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="689.0625" x="30.2083" y="389.681"/><text fill="#9C27B0" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="20.8333" x="56.25" y="412.7421">alt</text><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="206.25" x="144.7917" y="413.7838">[Last pod on node on node]</text><path d="M40.625,456.2826 L40.625,492.7409 A4.1667,4.1667 0 0 0 44.7917,496.9076 L635.4167,496.9076 A4.1667,4.1667 0 0 0 639.5833,492.7409 L639.5833,462.5326 L629.1667,452.1159 L44.7917,452.1159 A4.1667,4.1667 0 0 0 40.625,456.2826 " fill="url(#g8ourer27zhdd2)" filter="url(#f8ourer27zhdd)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><path d="M629.1667,452.1159 L629.1667,460.4492 A2.0833,2.0833 0 0 0 631.25,462.5326 L639.5833,462.5326 L629.1667,452.1159 " fill="url(#g8ourer27zhdd2)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="556.25" x="57.2917" y="479.3437">len(Info.Participating.PodsTerminating[&lt;node&gt;]) == len(Info.Participating.Pods[&lt;node&gt;])</text><line style="stroke:#2196F3;stroke-width:3.125;" x1="347.3958" x2="391.1458" y1="547.8841" y2="547.8841"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="391.1458" x2="391.1458" y1="547.8841" y2="561.4258"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="348.4375" x2="391.1458" y1="561.4258" y2="561.4258"/><polygon fill="#2196F3" points="358.8542,557.2591,348.4375,561.4258,358.8542,565.5924,354.6875,561.4258" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="331.25" x="365.1042" y="532.4361">set Info.Participating.Nodes[&lt;node&gt;] = "terminating"</text><line style="stroke:#2196F3;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="30.2083" x2="719.2708" y1="570.8008" y2="570.8008"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="312.5" x="45.8333" y="592.8202">[Pods still participating on node on node]</text><path d="M64.5833,616.6016 L64.5833,653.0599 A4.1667,4.1667 0 0 0 68.75,657.2266 L611.4583,657.2266 A4.1667,4.1667 0 0 0 615.625,653.0599 L615.625,622.8516 L605.2083,612.4349 L68.75,612.4349 A4.1667,4.1667 0 0 0 64.5833,616.6016 " fill="url(#g8ourer27zhdd2)" filter="url(#f8ourer27zhdd)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><path d="M605.2083,612.4349 L605.2083,620.7682 A2.0833,2.0833 0 0 0 607.2917,622.8516 L615.625,622.8516 L605.2083,612.4349 " fill="url(#g8ourer27zhdd2)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="504.1667" x="81.25" y="639.6627">len(Info.Participating.PodsTerminating) &gt;= 1  &amp;&amp; len(Info.Participating.Pods) &gt;= 1</text><polygon fill="#2196F3" points="771.3542,711.3281,781.7708,715.4948,771.3542,719.6615,775.5208,715.4948" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="342.1875" x2="777.6042" y1="715.4948" y2="715.4948"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="162.5" x="359.8958" y="700.0468">Update network resource</text><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="1269.2708" x2="1313.0208" y1="772.7539" y2="772.7539"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="1313.0208" x2="1313.0208" y1="772.7539" y2="786.2956"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="1270.3125" x2="1313.0208" y1="786.2956" y2="786.2956"/><polygon fill="#2196F3" points="1280.7292,782.1289,1270.3125,786.2956,1280.7292,790.4622,1276.5625,786.2956" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="296.875" x="1286.9792" y="757.3059">watch network CRDs and trigger reconcile loop</text><path d="M419.7917,801.9206 L515.625,801.9206 L515.625,828.9714 L505.2083,839.388 L415.625,839.388 L415.625,806.0872 A4.1667,4.1667 0 0 1 419.7917,801.9206 " fill="#FFFFFF" style="stroke:#666666;stroke-width:1.0416666666666667;"/><rect fill="none" height="772.2656" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="999.4792" x="415.625" y="801.9206"/><text fill="#9C27B0" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="32.2917" x="441.6667" y="824.9817">loop</text><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="193.75" x="541.6667" y="826.0234">[until the world explodes]</text><polygon fill="#2196F3" points="800.5208,896.6146,790.1042,900.7813,800.5208,904.9479,796.3542,900.7813" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="794.2708" x2="1268.2292" y1="900.7813" y2="900.7813"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="137.5" x="817.1875" y="885.3333">Re-Run reconcile loop</text><path d="M430.2083,916.4063 L602.0833,916.4063 L602.0833,943.457 L591.6667,953.8737 L426.0417,953.8737 L426.0417,920.5729 A4.1667,4.1667 0 0 1 430.2083,916.4063 " fill="#FFFFFF" style="stroke:#666666;stroke-width:1.0416666666666667;"/><rect fill="none" height="650.4883" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="978.6458" x="426.0417" y="916.4063"/><text fill="#9C27B0" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="108.3333" x="452.0833" y="939.4674">Reconcile loop</text><path d="M440.625,961.1654 L525,961.1654 L525,988.2161 L514.5833,998.6328 L436.4583,998.6328 L436.4583,965.332 A4.1667,4.1667 0 0 1 440.625,961.1654 " fill="#FFFFFF" style="stroke:#666666;stroke-width:1.0416666666666667;"/><rect fill="none" height="349.6419" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="693.75" x="436.4583" y="961.1654"/><text fill="#9C27B0" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="20.8333" x="462.5" y="984.2265">alt</text><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="257.2917" x="551.0417" y="985.2681">[Node not participating any more]</text><line style="stroke:#2196F3;stroke-width:3.125;" x1="789.0625" x2="832.8125" y1="1060.026" y2="1060.026"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="832.8125" x2="832.8125" y1="1060.026" y2="1073.5677"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="790.1042" x2="832.8125" y1="1073.5677" y2="1073.5677"/><polygon fill="#2196F3" points="800.5208,1069.401,790.1042,1073.5677,800.5208,1077.7344,796.3542,1073.5677" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="179.1667" x="806.7708" y="1044.578">Delete Jetstreams for nodes</text><path d="M485.4167,1091.276 L485.4167,1186.0677 A4.1667,4.1667 0 0 0 489.5833,1190.2344 L1075,1190.2344 A4.1667,4.1667 0 0 0 1079.1667,1186.0677 L1079.1667,1097.526 L1068.75,1087.1094 L489.5833,1087.1094 A4.1667,4.1667 0 0 0 485.4167,1091.276 " fill="url(#g8ourer27zhdd2)" filter="url(#f8ourer27zhdd)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><path d="M1068.75,1087.1094 L1068.75,1095.4427 A2.0833,2.0833 0 0 0 1070.8333,1097.526 L1079.1667,1097.526 L1068.75,1087.1094 " fill="url(#g8ourer27zhdd2)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="551.0417" x="502.0833" y="1114.3372">len(Info.Participating.PodsTerminating[&lt;node&gt;]) == len(Info.Participating.Pods[&lt;node&gt;]</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="401.0417" x="502.0833" y="1128.8879">1. Loop over Info.Participating.Nodes[&lt;node&gt;] == "terminating"</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="243.75" x="502.0833" y="1143.4387">2. Delete Jetstreams for looped nodes</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="269.7917" x="502.0833" y="1157.9895">3. Delete Info.Participating.Nodes[&lt;node&gt;]</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="259.375" x="502.0833" y="1172.5403">4. Delete Info.Participating.Pods[&lt;node&gt;]</text><line style="stroke:#2196F3;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="436.4583" x2="1130.2083" y1="1200.4883" y2="1200.4883"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="269.7917" x="452.0833" y="1222.5077">[Node still participating in network]</text><path d="M446.875,1246.2891 L446.875,1297.3307 A4.1667,4.1667 0 0 0 451.0417,1301.4974 L1112.5,1301.4974 A4.1667,4.1667 0 0 0 1116.6667,1297.3307 L1116.6667,1252.5391 L1106.25,1242.1224 L451.0417,1242.1224 A4.1667,4.1667 0 0 0 446.875,1246.2891 " fill="url(#g8ourer27zhdd2)" filter="url(#f8ourer27zhdd)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><path d="M1106.25,1242.1224 L1106.25,1250.4557 A2.0833,2.0833 0 0 0 1108.3333,1252.5391 L1116.6667,1252.5391 L1106.25,1242.1224 " fill="url(#g8ourer27zhdd2)" style="stroke:#1A78C2;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="627.0833" x="463.5417" y="1269.3502">len(Info.Participating.PodsTerminating[&lt;node&gt;]) &gt;= 1 &amp;&amp; len(Info.Participating.Pods[&lt;node&gt;]) &gt;= 1</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="407.2917" x="463.5417" y="1283.901">1. Leave value for Info.Participating.Nodes[&lt;node&gt;] on "created"</text><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="789.0625" x2="832.8125" y1="1359.7331" y2="1359.7331"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="832.8125" x2="832.8125" y1="1359.7331" y2="1373.2747"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="790.1042" x2="832.8125" y1="1373.2747" y2="1373.2747"/><polygon fill="#2196F3" points="800.5208,1369.1081,790.1042,1373.2747,800.5208,1377.4414,796.3542,1373.2747" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="439.5833" x="806.7708" y="1344.2851">remove deleted pod from Info.Participating.PodsTerminating[&lt;node&gt;]</text><path d="M657.8125,1388.8997 L742.1875,1388.8997 L742.1875,1415.9505 L731.7708,1426.3672 L653.6458,1426.3672 L653.6458,1393.0664 A4.1667,4.1667 0 0 1 657.8125,1388.8997 " fill="#FFFFFF" style="stroke:#666666;stroke-width:1.0416666666666667;"/><rect fill="none" height="170.7031" rx="4.1667" ry="4.1667" style="stroke:#2196F3;stroke-width:1.0416666666666667;" width="740.625" x="653.6458" y="1388.8997"/><text fill="#9C27B0" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="20.8333" x="679.6875" y="1411.9609">alt</text><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="231.25" x="768.2292" y="1413.0025">[If network resource changed]</text><line style="stroke:#2196F3;stroke-width:3.125;" x1="789.0625" x2="832.8125" y1="1487.7604" y2="1487.7604"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="832.8125" x2="832.8125" y1="1487.7604" y2="1501.3021"/><line style="stroke:#2196F3;stroke-width:3.125;" x1="790.1042" x2="832.8125" y1="1501.3021" y2="1501.3021"/><polygon fill="#2196F3" points="800.5208,1497.1354,790.1042,1501.3021,800.5208,1505.4688,796.3542,1501.3021" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="162.5" x="806.7708" y="1472.3124">Update network resource</text><polygon fill="#2196F3" points="1256.7708,1547.1029,1267.1875,1551.2695,1256.7708,1555.4362,1260.9375,1551.2695" style="stroke:#2196F3;stroke-width:1.0416666666666667;"/><line style="stroke:#2196F3;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="789.0625" x2="1263.0208" y1="1551.2695" y2="1551.2695"/><text fill="#222222" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="178.125" x="806.7708" y="1535.8215">Return and trigger Reconcile</text><!--MD5=[ff30e3fd516c9e45b95de351cb27507a]
@startuml
title Deleting jetstreams on leafnode connected devices
!theme materia from https://raw.githubusercontent.com/plantuml/plantuml/master/themes
skinparam backgroundColor white


pod -> pod_controller: delete pod <name>

' pod_controller reconcile loop
loop until the workd explodes
    activate pod_controller
    pod_controller - -> pod_controller: check for network participant pod

    pod_controller -> network_controller: Add podname to Info.Participating.PodsTerminating[<node>][]
    alt Last pod on node on node 
        note over pod_controller: len(Info.Participating.PodsTerminating[<node>]) == len(Info.Participating.Pods[<node>])
        pod_controller -> pod_controller: set Info.Participating.Nodes[<node>] = "terminating"
    else Pods still participating on node on node
        note over pod_controller
        len(Info.Participating.PodsTerminating) >= 1  && len(Info.Participating.Pods) >= 1 
        end note
    end
    pod_controller -> network_controller: Update network resource
    deactivate pod_controller
end

' network_controller reconcile trigger
reconcile_trigger - -> reconcile_trigger: watch network CRDs and trigger reconcile loop


' network_controller reconcile loop
loop until the world explodes
  reconcile_trigger - -> network_controller : Re-Run reconcile loop
  group Reconcile loop
    activate network_controller
    alt Node not participating any more
        network_controller -> network_controller: Delete Jetstreams for nodes
        note over network_controller
        len(Info.Participating.PodsTerminating[<node>]) == len(Info.Participating.Pods[<node>]
        1. Loop over Info.Participating.Nodes[<node>] == "terminating"
        2. Delete Jetstreams for looped nodes
        3. Delete Info.Participating.Nodes[<node>]
        4. Delete Info.Participating.Pods[<node>]
        end note
    else Node still participating in network
        note over network_controller
        len(Info.Participating.PodsTerminating[<node>]) >= 1 && len(Info.Participating.Pods[<node>]) >= 1
        1. Leave value for Info.Participating.Nodes[<node>] on "created"
        end note
    end
    
    network_controller - -> network_controller: remove deleted pod from Info.Participating.PodsTerminating[<node>]
    
    alt If network resource changed
        network_controller -> network_controller: Update network resource
        network_controller - -> reconcile_trigger: Return and trigger Reconcile
    end
    deactivate network_controller
  end
end
@enduml

@startuml
title Deleting jetstreams on leafnode connected devices



skinparam backgroundColor transparent
skinparam useBetaStyle false






<style>
  root {
    BackgroundColor transparent
    FontColor #FFF
    HyperLinkColor #fd7e14
    LineColor #1a78c2
    LineThickness 1
    Margin 10
    Padding 6
    Shadowing 0.0
  }
  node {
   Padding 15
   roundcorner 20
   BackgroundColor #2196F3-#1a78c2
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  groupHeader {
    BackgroundColor #fff
    FontColor #9C27B0
    FontStyle bold
  }
  header {
    LineThickness 0
  }
  referenceHeader {
    BackgroundColor transparent
    FontColor #222
    FontStyle bold
  }
  separator {
    BackgroundColor #222
    FontColor transparent
    FontStyle bold
  }
  title {
	FontSize 20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor  #fff-#fff
	FontColor #2196F3
	BorderColor #fff
  }
  nwdiagDiagram {
	network {
			FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3    
		LineColor #2196F3
		LineThickness 1.0
		FontColor #1a78c2
	}
	server {
			FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	}
	arrow {
		FontColor #1a78c2
		LineColor #1a78c2
	}
	group {
		BackGroundColor #fff
		LineColor $LIGHT_DARK
		LineThickness 2.0
		Margin 5
		Padding 5
	}
  }
  ganttDiagram {
	task {
			FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
		LineColor #2196F3
		Margin 10
		Padding 6
	}
	note {
		FontColor #FFF
		LineColor #7D1F8D
		BackGroundColor #9C27B0
	}
	separator {
		LineColor #fff
		BackGroundColor #fff-#cccccc
		FontColor #222
	}
	milestone {
		FontColor #9C27B0
		FontSize 16
		FontStyle italic
		BackGroundColor #fff
		LineColor #cccccc
	}
	timeline {
		BackgroundColor #fff
		FontColor #222
	}
	closed {
		BackgroundColor #CC7A00
		FontColor #FFF
	}
  }
</style>
skinparam defaultFontName       "Verdana"
skinparam defaultFontSize       12
skinparam dpi                   100
skinparam shadowing             true
skinparam roundcorner           8
skinparam ParticipantPadding    40
skinparam BoxPadding            40
skinparam Padding               10
skinparam ArrowColor            #666
skinparam stereotype {
    CBackgroundColor #fff
    CBorderColor #cccccc
    ABackgroundColor #70bf73
    ABorderColor #3D8C40
    IBackgroundColor #B7161C
    IBorderColor #b7161c
    EBackgroundColor #ffad33
    EBorderColor #CC7A00
    NBackgroundColor #b052c0
    NBorderColor #7D1F8D
}
skinparam title {
	FontColor	                 #2196F3
	BorderColor	                 #cccccc
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #fff-#fff
}

skinparam legend {
	BackgroundColor #fff
	BorderColor #cccccc
	FontColor #222
}

skinparam swimlane {
	BorderColor #9C27B0
	BorderThickness 2
	TitleBackgroundColor  #fff-#fff
	TitleFontColor #2196F3
}


skinparam activity {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	BarColor #4CAF50
	StartColor #9C27B0
	EndColor #9C27B0
	DiamondBackgroundColor #FFF-#fff
  	DiamondBorderColor #cccccc
	DiamondFontColor #222
}


skinparam participant {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	FontColor #222
}


skinparam arrow {
	Thickness 3
	Color #2196F3
	FontColor #222
}


skinparam sequence {
	BorderColor #2196F3
	TitleFontColor #2196F3
	BackgroundColor transparent
	StartColor #2196F3
	EndColor #2196F3
	BoxBackgroundColor #fff
	BoxBorderColor #666
	BoxFontColor #222
	DelayFontColor #222
	LifeLineBorderColor #cccccc
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #fff
	GroupBorderColor #666
	GroupFontColor #222
	GroupHeaderFontColor #9C27B0
	DividerBackgroundColor #FFF-#fff
    DividerBorderColor #666
    DividerBorderThickness 2
    DividerFontColor #222
	ReferenceBackgroundColor transparent
	ReferenceBorderColor #666
	ReferenceFontColor #222
	ReferenceHeaderFontColor #9C27B0
	StereotypeFontColor #FFF
}


skinparam partition {
	BorderColor #2196F3
	FontColor #2196F3
	BackgroundColor transparent
}


skinparam collections {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
}


skinparam control {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	FontColor #222
}


skinparam entity {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	FontColor #222
}


skinparam boundary {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	FontColor #222
}


skinparam agent {
	BackgroundColor #orange
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor #b052c0-#9C27B0
	BorderColor #9C27B0
	FontColor #FFF
}


skinparam artifact {
	BackgroundColor #FFF-#fff
	BorderColor #666
	FontColor #666
}


skinparam component {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
}


skinparam interface {
	BackgroundColor  #B7161C
	BorderColor  #e51c23
	FontColor #222
}


skinparam storage {
	BackgroundColor #ffad33-#ff9800
  	BorderColor #ff9800
	FontColor #FFF
}


skinparam node {
	BackgroundColor #fff-#fff
	BorderColor #222
	FontColor #222
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor #F2FCFE
	FontColor #222
}


skinparam database {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	FontColor #222
}


skinparam class {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	HeaderBackgroundColor #2196F3-#1a78c2
	StereotypeFontColor #222
	BorderThickness 1
	AttributeFontColor #fff
	AttributeFontSize 11
}


skinparam object {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	StereotypeFontColor #222
	BorderThickness 1
	AttributeFontColor #222
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	BorderThickness 2
	StereotypeFontColor #2196F3
}


skinparam rectangle {
	FontColor #2196F3
	BackgroundColor #fff-#fff
	BorderThickness 2
	StereotypeFontColor #2196F3
}


skinparam package {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	BackgroundColor #fff-#fff
	BorderThickness 2
}


skinparam folder {
	BackgroundColor #FFF-#fff
  	BorderColor #ff9800
	FontColor #ff9800
	BorderThickness 2
}


skinparam frame {
	BackgroundColor #FFF-#fff
  	BorderColor #9C27B0
	FontColor #9C27B0
	BorderThickness 2
}


skinparam state {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
	BorderColor #1a78c2
	StartColor #9C27B0
	EndColor #9C27B0
	AttributeFontColor #222
	AttributeFontSize 11
}


skinparam queue {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
}


skinparam card {
	BackgroundColor #b052c0-#9C27B0
	BorderColor #9C27B0
	FontColor #FFF
}


skinparam file {
	BackgroundColor #fff-#fff
	BorderColor #666
	FontColor #666

}


skinparam stack {
		FontColor #FFF
	BorderColor #2196F3
	BackgroundColor #4dabf5-#2196F3
}
skinparam backgroundColor white


pod -> pod_controller: delete pod <name>

loop until the workd explodes
    activate pod_controller
    pod_controller - -> pod_controller: check for network participant pod

    pod_controller -> network_controller: Add podname to Info.Participating.PodsTerminating[<node>][]
    alt Last pod on node on node 
        note over pod_controller: len(Info.Participating.PodsTerminating[<node>]) == len(Info.Participating.Pods[<node>])
        pod_controller -> pod_controller: set Info.Participating.Nodes[<node>] = "terminating"
    else Pods still participating on node on node
        note over pod_controller
        len(Info.Participating.PodsTerminating) >= 1  && len(Info.Participating.Pods) >= 1 
        end note
    end
    pod_controller -> network_controller: Update network resource
    deactivate pod_controller
end

reconcile_trigger - -> reconcile_trigger: watch network CRDs and trigger reconcile loop


loop until the world explodes
  reconcile_trigger - -> network_controller : Re-Run reconcile loop
  group Reconcile loop
    activate network_controller
    alt Node not participating any more
        network_controller -> network_controller: Delete Jetstreams for nodes
        note over network_controller
        len(Info.Participating.PodsTerminating[<node>]) == len(Info.Participating.Pods[<node>]
        1. Loop over Info.Participating.Nodes[<node>] == "terminating"
        2. Delete Jetstreams for looped nodes
        3. Delete Info.Participating.Nodes[<node>]
        4. Delete Info.Participating.Pods[<node>]
        end note
    else Node still participating in network
        note over network_controller
        len(Info.Participating.PodsTerminating[<node>]) >= 1 && len(Info.Participating.Pods[<node>]) >= 1
        1. Leave value for Info.Participating.Nodes[<node>] on "created"
        end note
    end
    
    network_controller - -> network_controller: remove deleted pod from Info.Participating.PodsTerminating[<node>]
    
    alt If network resource changed
        network_controller -> network_controller: Update network resource
        network_controller - -> reconcile_trigger: Return and trigger Reconcile
    end
    deactivate network_controller
  end
end
@enduml

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>